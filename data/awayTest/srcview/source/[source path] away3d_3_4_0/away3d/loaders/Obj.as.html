<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Obj.as</title>
<link rel="stylesheet" type="text/css" href="../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">loaders</span><span class="ActionScriptBracket/Brace">{</span>    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">containers</span>.<span class="ActionScriptDefault_Text">ObjectContainer3D</span>;    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">arcane</span>;    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">base</span>.<span class="ActionScriptOperator">*</span>;    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptOperator">*</span>;    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">BitmapFileMaterial</span>;         <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptOperator">*</span>;    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">net</span>.<span class="ActionScriptOperator">*</span>;        <span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">arcane</span>;        <span class="ActionScriptASDoc">/**    * File loader for the OBJ file format.&lt;br/&gt;    * &lt;br/&gt;    * note: Multiple objects support and autoload mtls are supported since Away v 2.1.&lt;br/&gt;    * Class tested with the following 3D apps:&lt;br/&gt;    * - Strata CX mac 5.5&lt;br/&gt;    * - Biturn ver 0.87b4 PC&lt;br/&gt;    * - LightWave 3D OBJ Export v2.1 PC&lt;br/&gt;    * - Max2Obj Version 4.0 PC&lt;br/&gt;    * - AC3D 6.2.025 mac&lt;br/&gt;    * - Carrara (file provided)&lt;br/&gt;    * - Hexagon (file provided)&lt;br/&gt;    * - geometry supported tags: f,v,vt, g&lt;br/&gt;    * - geometry unsupported tags:vn,ka, kd r g b, kd, ks r g b,ks,ke r g b,ke,d alpha,d,tr alpha,tr,ns s,ns,illum n,illum,map_Ka,map_Bump&lt;br/&gt;    * - mtl unsupported tags: kd,ka,ks,ns,tr&lt;br/&gt;     * &lt;br/&gt;    * export from apps as polygon group or mesh as .obj file.&lt;br/&gt;    * added support for 3dmax negative vertexes references    */</span>    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">Obj</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">AbstractParser</span>    <span class="ActionScriptBracket/Brace">{</span>        <span class="ActionScriptASDoc">/** @private */</span>        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">prepareData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:*</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">obj</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Cast</span>.<span class="ActionScriptDefault_Text">string</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obj</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;\n&apos;</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">lines</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obj</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span>.<span class="ActionScriptDefault_Text">fromCharCode</span><span class="ActionScriptBracket/Brace">(</span>13<span class="ActionScriptBracket/Brace">))</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">isNew</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">group</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ObjectContainer3D</span>;                         <span class="ActionScriptDefault_Text">vertices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vertex</span><span class="ActionScriptBracket/Brace">()]</span>;            <span class="ActionScriptDefault_Text">uvs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">UV</span><span class="ActionScriptBracket/Brace">()]</span>;                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">isNeg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">myPattern</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">RegExp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">RegExp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;-&quot;</span>,<span class="ActionScriptString">&quot;g&quot;</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">face0</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">face2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">face3</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;                         <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">line</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptBracket/Brace">)</span>            <span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptDefault_Text">trunk</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;  &quot;</span>,<span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;  &quot;</span>,<span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;  &quot;</span>,<span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>;                                 <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>                <span class="ActionScriptBracket/Brace">{</span>                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;g&quot;</span><span class="ActionScriptOperator">:</span>                        <span class="ActionScriptDefault_Text">group</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectContainer3D</span><span class="ActionScriptBracket/Brace">()</span>;                        <span class="ActionScriptDefault_Text">group</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>;                                                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>                            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">aMeshes</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 1<span class="ActionScriptBracket/Brace">){</span>                                <span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectContainer3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">aMeshes</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptBracket/Brace">)</span>;                            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>                                <span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectContainer3D</span><span class="ActionScriptBracket/Brace">()</span>;                            <span class="ActionScriptBracket/Brace">}</span>                        <span class="ActionScriptBracket/Brace">}</span>                                                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ObjectContainer3D</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">group</span><span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptDefault_Text">isNew</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;                                                <span class="ActionScriptReserved">break</span>;                                            <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;usemtl&quot;</span><span class="ActionScriptOperator">:</span>                        <span class="ActionScriptDefault_Text">aMeshes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">aMeshes</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">materialid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>;                        <span class="ActionScriptReserved">break</span>;                                            <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;v&quot;</span><span class="ActionScriptOperator">:</span>                         <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isNew</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>                            <span class="ActionScriptDefault_Text">generateNewMesh</span><span class="ActionScriptBracket/Brace">()</span>;                            <span class="ActionScriptDefault_Text">isNew</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;                            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">group</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">){</span>                                <span class="ActionScriptDefault_Text">group</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptBracket/Brace">)</span>;                            <span class="ActionScriptBracket/Brace">}</span>                        <span class="ActionScriptBracket/Brace">}</span>                                                 <span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vertex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">scaling</span>, <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">scaling</span>, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">scaling</span><span class="ActionScriptBracket/Brace">))</span>;                                                <span class="ActionScriptReserved">break</span>;                                            <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;vt&quot;</span><span class="ActionScriptOperator">:</span>                        <span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">UV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])</span>, <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">])))</span>;                        <span class="ActionScriptReserved">break</span>;                                            <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;f&quot;</span><span class="ActionScriptOperator">:</span>                        <span class="ActionScriptDefault_Text">isNew</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;                                                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;-&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>                                                        <span class="ActionScriptDefault_Text">face0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">trysplit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;                            <span class="ActionScriptDefault_Text">face1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">trysplit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;                            <span class="ActionScriptDefault_Text">face2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">trysplit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;                                                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">){</span>                                <span class="ActionScriptDefault_Text">face3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">trysplit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;                            <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>                                <span class="ActionScriptDefault_Text">face3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;                            <span class="ActionScriptBracket/Brace">}</span>                                                        <span class="ActionScriptDefault_Text">isNeg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;                                                    <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>                                                        <span class="ActionScriptDefault_Text">face0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">trysplit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">myPattern</span>, <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span> , <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;                            <span class="ActionScriptDefault_Text">face1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">trysplit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">myPattern</span>, <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span> , <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;                            <span class="ActionScriptDefault_Text">face2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">trysplit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">myPattern</span>, <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span> , <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;                                                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">){</span>                                <span class="ActionScriptDefault_Text">face3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">trysplit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">myPattern</span>, <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span> , <span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;                            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>                                <span class="ActionScriptDefault_Text">face3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;                            <span class="ActionScriptBracket/Brace">}</span>                                                        <span class="ActionScriptDefault_Text">isNeg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;                        <span class="ActionScriptBracket/Brace">}</span>                                                                        <span class="ActionScriptReserved">try</span><span class="ActionScriptBracket/Brace">{</span>                                                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face3</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">face3</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">&gt;</span>0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">isNaN</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face3</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]))</span> <span class="ActionScriptBracket/Brace">){</span>                                                                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isNeg</span><span class="ActionScriptBracket/Brace">){</span>                                                                        <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Face</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face0</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face3</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>,                                                      <span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>1, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>2, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face0</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>3, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face3</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span>  <span class="ActionScriptBracket/Brace">))</span>;                                            <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Face</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face2</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face3</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>,                                                      <span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>1, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face2</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>2, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>3, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face3</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span> <span class="ActionScriptBracket/Brace">))</span>;                                                                    <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>                                                                        <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Face</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face0</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face3</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>,                                                      <span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>1, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>2, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face0</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>3, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face3</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span> <span class="ActionScriptBracket/Brace">))</span>;                                            <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Face</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face2</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face3</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>,                                                      <span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>1, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face2</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>2, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>3, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face3</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span> <span class="ActionScriptBracket/Brace">))</span>;                                <span class="ActionScriptBracket/Brace">}</span>                                                            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>                                                                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isNeg</span><span class="ActionScriptBracket/Brace">){</span>                                                                        <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Face</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face2</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face0</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>,                                                      <span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>1, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face2</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>2, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>3, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face0</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span> <span class="ActionScriptBracket/Brace">))</span>;                                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>                                                                         <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Face</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face2</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face0</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])]</span>,                                                      <span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>1, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face2</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>2, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span>, <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span>3, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">face0</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])])</span> <span class="ActionScriptBracket/Brace">))</span>;                                <span class="ActionScriptBracket/Brace">}</span>                                                            <span class="ActionScriptBracket/Brace">}</span>                                                                                <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">catch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">){</span>                            <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Error while parsing obj file: unvalid face f &quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">face0</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot;,&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">face1</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot;,&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">face2</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot;,&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">face3</span><span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptBracket/Brace">}</span>                                                <span class="ActionScriptReserved">break</span>;                                     <span class="ActionScriptBracket/Brace">}</span>            <span class="ActionScriptBracket/Brace">}</span>                         <span class="ActionScriptDefault_Text">vertices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;            <span class="ActionScriptDefault_Text">uvs</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mesh</span>;                        <span class="ActionScriptComment">//check materials</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">obj</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;mtllib&quot;</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">){</span>                <span class="ActionScriptDefault_Text">aSources</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;                <span class="ActionScriptDefault_Text">loadMtl</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parseUrl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span>, <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptBracket/Brace">))</span>;            <span class="ActionScriptBracket/Brace">}</span>        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Mesh</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mtlPath</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">aMeshes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">aSources</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">aMats</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">scaling</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;                  <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">checkUV</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UV</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">UV</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">){</span>                <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">){</span>                    <span class="ActionScriptReserved">case</span> 1<span class="ActionScriptOperator">:</span>                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">UV</span><span class="ActionScriptBracket/Brace">(</span>0, 1<span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptReserved">break</span>;                    <span class="ActionScriptReserved">case</span> 2<span class="ActionScriptOperator">:</span>                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">UV</span><span class="ActionScriptBracket/Brace">(</span>.5, 0<span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptReserved">break</span>;                    <span class="ActionScriptReserved">case</span> 3<span class="ActionScriptOperator">:</span>                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">UV</span><span class="ActionScriptBracket/Brace">(</span>1, 1<span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptReserved">break</span>;                <span class="ActionScriptBracket/Brace">}</span>                                <span class="ActionScriptBracket/Brace">}</span>                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">uv</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">trysplit</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">by</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">by</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptReserved">return</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">]</span>;                            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">by</span><span class="ActionScriptBracket/Brace">)</span>;        <span class="ActionScriptBracket/Brace">}</span>                 <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">errorMtl</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Obj MTL LOAD ERROR: unable to load .mtl file at &quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">mtlPath</span><span class="ActionScriptBracket/Brace">)</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">mtlProgress</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>             <span class="ActionScriptComment">//NOT BUILDED IN YET</span>             <span class="ActionScriptComment">//trace( (event.target.bytesLoaded / event.target.bytesTotal) *100);</span>        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">loadMtl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">url</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">loader</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URLLoader</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLLoader</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">loader</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span>.<span class="ActionScriptDefault_Text">COMPLETE</span>, <span class="ActionScriptDefault_Text">parseMtl</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptDefault_Text">loader</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">IOErrorEvent</span>.<span class="ActionScriptDefault_Text">IO_ERROR</span>, <span class="ActionScriptDefault_Text">errorMtl</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptDefault_Text">loader</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SecurityErrorEvent</span>.<span class="ActionScriptDefault_Text">SECURITY_ERROR</span>, <span class="ActionScriptDefault_Text">errorMtl</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptDefault_Text">loader</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ProgressEvent</span>.<span class="ActionScriptDefault_Text">PROGRESS</span>, <span class="ActionScriptDefault_Text">mtlProgress</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptDefault_Text">loader</span>.<span class="ActionScriptDefault_Text">load</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mtlPath</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">url</span><span class="ActionScriptBracket/Brace">))</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseUrl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">index</span><span class="ActionScriptOperator">+</span>7,<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;.mtl&quot;</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span>4<span class="ActionScriptBracket/Brace">)</span>;        <span class="ActionScriptBracket/Brace">}</span>                  <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseMtl</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">target</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;data&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;\n&apos;</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">lines</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">target</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;data&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span>.<span class="ActionScriptDefault_Text">fromCharCode</span><span class="ActionScriptBracket/Brace">(</span>13<span class="ActionScriptBracket/Brace">))</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_face</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Face</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mat</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BitmapFileMaterial</span>;            <span class="ActionScriptDefault_Text">aMats</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">line</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptBracket/Brace">)</span>            <span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptDefault_Text">trunk</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>                <span class="ActionScriptBracket/Brace">{</span>                                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;newmtl&quot;</span><span class="ActionScriptOperator">:</span>                        <span class="ActionScriptDefault_Text">aSources</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">({</span><span class="ActionScriptDefault_Text">material</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">materialid</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]})</span>;                        <span class="ActionScriptReserved">break</span>;                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;map_Kd&quot;</span><span class="ActionScriptOperator">:</span>                        <span class="ActionScriptDefault_Text">mat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">checkDoubleMaterials</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mtlPath</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">trunk</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])</span>;                         <span class="ActionScriptDefault_Text">aSources</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">aSources</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">material</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mat</span>;                        <span class="ActionScriptComment">//aSources[aSources.length-1].material = new BitmapFileMaterial(baseUrl+trunk[1]);</span>                        <span class="ActionScriptReserved">break</span>;                <span class="ActionScriptBracket/Brace">}</span>            <span class="ActionScriptBracket/Brace">}</span>                        <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">=</span> 0;<span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">aMeshes</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">){</span>                <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">aSources</span>.<span class="ActionScriptDefault_Text">length</span>;<span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">){</span>                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">aMeshes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">materialid</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">aSources</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">materialid</span><span class="ActionScriptBracket/Brace">){</span>                        <span class="ActionScriptDefault_Text">mat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">aSources</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">material</span>;                        <span class="ActionScriptDefault_Text">aMeshes</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">material</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mat</span>;                        <span class="ActionScriptComment">/*for each(_face in aMeshes[j].mesh.faces)                            _face.material = mat;*/</span>                    <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptBracket/Brace">}</span>            <span class="ActionScriptBracket/Brace">}</span>                        <span class="ActionScriptDefault_Text">aSources</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;            <span class="ActionScriptDefault_Text">aMats</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">checkDoubleMaterials</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">url</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BitmapFileMaterial</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mat</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BitmapFileMaterial</span>;            <span class="ActionScriptReserved">for</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">aMats</span>.<span class="ActionScriptDefault_Text">length</span>;<span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">){</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">aMats</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">url</span><span class="ActionScriptBracket/Brace">){</span>                    <span class="ActionScriptDefault_Text">mat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">aMats</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">material</span>;                    <span class="ActionScriptDefault_Text">aMats</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">({</span><span class="ActionScriptDefault_Text">url</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">url</span>, <span class="ActionScriptDefault_Text">material</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">mat</span><span class="ActionScriptBracket/Brace">})</span>;                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mat</span>;                <span class="ActionScriptBracket/Brace">}</span>            <span class="ActionScriptBracket/Brace">}</span>                        <span class="ActionScriptDefault_Text">mat</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BitmapFileMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">url</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span>.<span class="ActionScriptDefault_Text">fromCharCode</span><span class="ActionScriptBracket/Brace">(</span>13<span class="ActionScriptBracket/Brace">)</span>,<span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptDefault_Text">aMats</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">({</span><span class="ActionScriptDefault_Text">url</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">url</span>, <span class="ActionScriptDefault_Text">material</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">mat</span><span class="ActionScriptBracket/Brace">})</span>;            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mat</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">generateNewMesh</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">mesh</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Mesh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ini</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;obj_&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">aMeshes</span>.<span class="ActionScriptDefault_Text">length</span>;            <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;.Obj&quot;</span>;                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">aMeshes</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 1 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectContainer3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">aMeshes</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptBracket/Brace">)</span>;                            <span class="ActionScriptDefault_Text">aMeshes</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">({</span><span class="ActionScriptDefault_Text">materialid</span><span class="ActionScriptOperator">:</span><span class="ActionScriptString">&quot;&quot;</span>, <span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptBracket/Brace">})</span>;            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">aMeshes</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 1 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ObjectContainer3D</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptBracket/Brace">)</span>;        <span class="ActionScriptBracket/Brace">}</span>               <span class="ActionScriptASDoc">/**         * Creates a new &lt;code&gt;Obj&lt;/code&gt; object.         *          * @param    init    [optional]    An initialisation object for specifying default instance properties.         *          * @see away3d.loaders.Obj#parse()         * @see away3d.loaders.Obj#load()         */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Obj</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">init</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>        <span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">init</span><span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptDefault_Text">mtlPath</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ini</span>.<span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;mtlPath&quot;</span>, <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptDefault_Text">scaling</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ini</span>.<span class="ActionScriptDefault_Text">getNumber</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;scaling&quot;</span>, 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> 10;                        <span class="ActionScriptDefault_Text">binary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;        <span class="ActionScriptBracket/Brace">}</span>        <span class="ActionScriptASDoc">/**         * Creates a 3d mesh object from the raw ascii data of a obj file.         *          * @param    data                The ascii data of a loaded file.         * @param    init                [optional]    An initialisation object for specifying default instance properties.         *          * @return                        A 3d mesh object representation of the obj file.         */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parse</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:*</span>, <span class="ActionScriptDefault_Text">init</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object3D</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">Loader3D</span>.<span class="ActionScriptDefault_Text">parseGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span>, <span class="ActionScriptDefault_Text">Obj</span>, <span class="ActionScriptDefault_Text">init</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">handle</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptASDoc">/**         * Loads and parses a obj file into a 3d mesh object.         *          * @param    url                    The url location of the file to load.         * @param    init    [optional]    An initialisation object for specifying default instance properties.         *          * @return                        A 3d loader object that can be used as a placeholder in a scene while the file is loading.         */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">load</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">url</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">init</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Loader3D</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptComment">//mtlPath as model folder</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">url</span><span class="ActionScriptBracket/Brace">)</span>            <span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_pathArray</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">url</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptDefault_Text">_pathArray</span>.<span class="ActionScriptDefault_Text">pop</span><span class="ActionScriptBracket/Brace">()</span>;                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_mtlPath</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_pathArray</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">&gt;</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">_pathArray</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">+</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">_pathArray</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">init</span><span class="ActionScriptBracket/Brace">){</span>                    <span class="ActionScriptDefault_Text">init</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;mtlPath&quot;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">init</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;mtlPath&quot;</span><span class="ActionScriptBracket/Brace">])</span><span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">init</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;mtlPath&quot;</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">_mtlPath</span>;                <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>                    <span class="ActionScriptDefault_Text">init</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptDefault_Text">mtlPath</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">_mtlPath</span> <span class="ActionScriptBracket/Brace">}</span>;                <span class="ActionScriptBracket/Brace">}</span>            <span class="ActionScriptBracket/Brace">}</span>            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">Loader3D</span>.<span class="ActionScriptDefault_Text">loadGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">url</span>, <span class="ActionScriptDefault_Text">Obj</span>, <span class="ActionScriptDefault_Text">init</span><span class="ActionScriptBracket/Brace">)</span>;        <span class="ActionScriptBracket/Brace">}</span>    <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
