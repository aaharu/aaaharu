<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>CenterLightingMaterial.as</title>
<link rel="stylesheet" type="text/css" href="../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">materials</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">arcane</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">containers</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">base</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">draw</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">light</span>.<span class="ActionScriptDefault_Text">DirectionalLight</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">light</span>.<span class="ActionScriptDefault_Text">PointLight</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">math</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">render</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3d</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptOperator">*</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">display</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptOperator">*</span>;
    
    <span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">arcane</span>;
    
    <span class="ActionScriptASDoc">/**
    * Abstract class for materials that calculate lighting for the face&apos;s center
    * Not intended for direct use - use &lt;code&gt;ShadingColorMaterial&lt;/code&gt; or &lt;code&gt;WhiteShadingBitmapMaterial&lt;/code&gt;.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">CenterLightingMaterial</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">EventDispatcher</span> <span class="ActionScriptReserved">implements</span> <span class="ActionScriptDefault_Text">ITriangleMaterial</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptASDoc">/** @private */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_id</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptASDoc">/** @private */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">session</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">AbstractRenderSession</span>;
        <span class="ActionScriptASDoc">/** @private */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_materialDirty</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;
        <span class="ActionScriptASDoc">/** @private */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">notifyMaterialUpdate</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_materialDirty</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">hasEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MaterialEvent</span>.<span class="ActionScriptDefault_Text">MATERIAL_UPDATED</span><span class="ActionScriptBracket/Brace">))</span>
                <span class="ActionScriptReserved">return</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_materialupdated</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">_materialupdated</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MaterialEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MaterialEvent</span>.<span class="ActionScriptDefault_Text">MATERIAL_UPDATED</span>, <span class="ActionScriptReserved">this</span><span class="ActionScriptBracket/Brace">)</span>;
                
            <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_materialupdated</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptComment">//private var directional:DirectionalLight;
</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">zoom</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">persp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v0x</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v0y</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v0z</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v1x</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v1y</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v1z</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v2x</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v2y</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v2z</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d1x</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d1y</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d1z</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d2x</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d2y</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d2z</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pa</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pb</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">pdd</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c0x</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c0y</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c0z</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kar</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kag</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kab</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kdr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kdg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">kdb</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ksr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ksg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ksb</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">red</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">green</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">blue</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">df</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ny</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nz</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fade</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">amb</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nf</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">diff</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rfx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rfy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rfz</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">spec</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rf</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">graphics</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Graphics</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cz</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">cy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ncz</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ncx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ncy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sum</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ffz</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ffx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ffy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fz</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rz</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ry</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">draw_normal</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">draw_fall</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">draw_fall_k</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">draw_reflect</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">draw_reflect_k</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_diffuseTransform</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MatrixAway3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_specularTransform</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MatrixAway3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_viewPosition</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_source</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Mesh</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_view</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">View3D</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_materialupdated</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialEvent</span>;
        
        <span class="ActionScriptASDoc">/**
        * Instance of the Init object used to hold and parse default property values
        * specified by the initialiser object in the 3d object constructor.
        */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ini</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Init</span>;
        
        <span class="ActionScriptASDoc">/** @private */</span>
        <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">renderTri</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DrawTriangle</span>, <span class="ActionScriptDefault_Text">session</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">AbstractRenderSession</span>, <span class="ActionScriptDefault_Text">kar</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">kag</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">kab</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">kdr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">kdg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">kdb</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">ksr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">ksg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">ksb</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">throw</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Not implemented&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
        * Coefficient for ambient light level
        */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ambient_brightness</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1;
        
        <span class="ActionScriptASDoc">/**
        * Coefficient for diffuse light level
        */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">diffuse_brightness</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1;
        
        <span class="ActionScriptASDoc">/**
        * Coefficient for specular light level
        */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">specular_brightness</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1;
        
        <span class="ActionScriptASDoc">/**
        * Coefficient for shininess level
        */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">shininess</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 20;
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">throw</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Not implemented&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
                
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_id</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @private
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">CenterLightingMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">init</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">ini</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Init</span>.<span class="ActionScriptDefault_Text">parse</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">init</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">shininess</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ini</span>.<span class="ActionScriptDefault_Text">getColor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;shininess&quot;</span>, 20<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">updateMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object3D</span>, <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">View3D</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_source_lightarray_directionals</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">lightarray</span>.<span class="ActionScriptDefault_Text">directionals</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">directional</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DirectionalLight</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_source_lightarray_directionals</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">diffuseTransform</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">scene</span>.<span class="ActionScriptDefault_Text">updatedObjects</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">setDiffuseTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_materialDirty</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">specularTransform</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">])</span>
                    <span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">specularTransform</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">specularTransform</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">][</span><span class="ActionScriptDefault_Text">view</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">scene</span>.<span class="ActionScriptDefault_Text">updatedObjects</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">updated</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">setSpecularTransform</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span>, <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_materialDirty</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">source_lightarray_points</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">lightarray</span>.<span class="ActionScriptDefault_Text">points</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">PointLight</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">source_lightarray_points</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">point</span>.<span class="ActionScriptDefault_Text">viewPositions</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">view</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">scene</span>.<span class="ActionScriptDefault_Text">updatedObjects</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">updated</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">point</span>.<span class="ActionScriptDefault_Text">setViewPosition</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">view</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_materialDirty</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_materialDirty</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">clearFaces</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span>, <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">clearFaces</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">view</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">View3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">source</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">source</span>;
            <span class="ActionScriptDefault_Text">view</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">view</span>;
            <span class="ActionScriptDefault_Text">notifyMaterialUpdate</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">renderTriangle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tri</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DrawTriangle</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">session</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">session</span>;
            <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">camera</span>.<span class="ActionScriptDefault_Text">focus</span>;
            <span class="ActionScriptDefault_Text">zoom</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">view</span>.<span class="ActionScriptDefault_Text">camera</span>.<span class="ActionScriptDefault_Text">zoom</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">endIndex</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">startIndex</span> <span class="ActionScriptOperator">&gt;</span> 10<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">indexA</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">screenIndices</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span>3;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">indexB</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">screenIndices</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span>3;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">indexC</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">screenIndices</span><span class="ActionScriptBracket/Brace">[</span>9<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span>3;
                
                <span class="ActionScriptDefault_Text">v0z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">indexA</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">persp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v0z</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">zoom</span>;
                <span class="ActionScriptDefault_Text">v0x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">indexA</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">persp</span>;
                <span class="ActionScriptDefault_Text">v0y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">indexA</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">persp</span>;
                
                <span class="ActionScriptDefault_Text">v1z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">indexB</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">persp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v1z</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">zoom</span>;
                <span class="ActionScriptDefault_Text">v1x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">indexB</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">persp</span>;
                <span class="ActionScriptDefault_Text">v1y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">indexB</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">persp</span>;
                
                <span class="ActionScriptDefault_Text">v2z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">indexC</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">persp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v2z</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">zoom</span>;
                <span class="ActionScriptDefault_Text">v2x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">indexC</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">persp</span>;
                <span class="ActionScriptDefault_Text">v2y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">screenVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">indexC</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">persp</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">v0z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v0z</span>;
                <span class="ActionScriptDefault_Text">persp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v0z</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">zoom</span>;
                <span class="ActionScriptDefault_Text">v0x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v0x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">persp</span>;
                <span class="ActionScriptDefault_Text">v0y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v0y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">persp</span>;
                
                <span class="ActionScriptDefault_Text">v1z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v1z</span>;
                <span class="ActionScriptDefault_Text">persp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v1z</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">zoom</span>;
                <span class="ActionScriptDefault_Text">v1x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v1x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">persp</span>;
                <span class="ActionScriptDefault_Text">v1y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v1y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">persp</span>;
                
                <span class="ActionScriptDefault_Text">v2z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v2z</span>;
                <span class="ActionScriptDefault_Text">persp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v2z</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">zoom</span>;
                <span class="ActionScriptDefault_Text">v2x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v2x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">persp</span>;
                <span class="ActionScriptDefault_Text">v2y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">v2y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">persp</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">d1x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v1x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v0x</span>;
            <span class="ActionScriptDefault_Text">d1y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v1y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v0y</span>;
            <span class="ActionScriptDefault_Text">d1z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v1z</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v0z</span>;
            
            <span class="ActionScriptDefault_Text">d2x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v2x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v0x</span>;
            <span class="ActionScriptDefault_Text">d2y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v2y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v0y</span>;
            <span class="ActionScriptDefault_Text">d2z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">v2z</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">v0z</span>;
            
            <span class="ActionScriptDefault_Text">pa</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d1y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d2z</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">d1z</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d2y</span>;
            <span class="ActionScriptDefault_Text">pb</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d1z</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d2x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">d1x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d2z</span>;
            <span class="ActionScriptDefault_Text">pc</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">d1x</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d2y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">d1y</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">d2x</span>;
            <span class="ActionScriptDefault_Text">pdd</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">pa</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pa</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">pb</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pb</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">pc</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pc</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">pa</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">pdd</span>;
            <span class="ActionScriptDefault_Text">pb</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">pdd</span>;
            <span class="ActionScriptDefault_Text">pc</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">pdd</span>;
            
            <span class="ActionScriptDefault_Text">c0x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v0x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v1x</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v2x</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 3;
            <span class="ActionScriptDefault_Text">c0y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v0y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v1y</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v2y</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 3;
            <span class="ActionScriptDefault_Text">c0z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v0z</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v1z</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">v2z</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 3;
            
            <span class="ActionScriptDefault_Text">kar</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">kag</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">kab</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">kdr</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">kdg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">kdb</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ksr</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ksg</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ksb</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptDefault_Text">_source</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">source</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Mesh</span>;
            <span class="ActionScriptDefault_Text">_view</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">view</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">directional</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">DirectionalLight</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_tri_source_lightarray_directionals</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">lightarray</span>.<span class="ActionScriptDefault_Text">directionals</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">directional</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_tri_source_lightarray_directionals</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_diffuseTransform</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">diffuseTransform</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_source</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">red</span>;
                <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">green</span>;
                <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">blue</span>;
                
                <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_diffuseTransform</span>.<span class="ActionScriptDefault_Text">szx</span>;
                <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_diffuseTransform</span>.<span class="ActionScriptDefault_Text">szy</span>;
                <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_diffuseTransform</span>.<span class="ActionScriptDefault_Text">szz</span>;
                
                <span class="ActionScriptDefault_Text">nx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">faceVO</span>.<span class="ActionScriptDefault_Text">face</span>.<span class="ActionScriptDefault_Text">normal</span>.<span class="ActionScriptDefault_Text">x</span>;
                <span class="ActionScriptDefault_Text">ny</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">faceVO</span>.<span class="ActionScriptDefault_Text">face</span>.<span class="ActionScriptDefault_Text">normal</span>.<span class="ActionScriptDefault_Text">y</span>;
                <span class="ActionScriptDefault_Text">nz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">faceVO</span>.<span class="ActionScriptDefault_Text">face</span>.<span class="ActionScriptDefault_Text">normal</span>.<span class="ActionScriptDefault_Text">z</span>;
                
                <span class="ActionScriptDefault_Text">amb</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">ambient</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ambient_brightness</span>;
                
                <span class="ActionScriptDefault_Text">kar</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">amb</span>;
                <span class="ActionScriptDefault_Text">kag</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">amb</span>;
                <span class="ActionScriptDefault_Text">kab</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">amb</span>;
                
                <span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nx</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ny</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nz</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">continue</span>;
                
                <span class="ActionScriptDefault_Text">diff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">diffuse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diffuse_brightness</span>;
                
                <span class="ActionScriptDefault_Text">kdr</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diff</span>;
                <span class="ActionScriptDefault_Text">kdg</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diff</span>;
                <span class="ActionScriptDefault_Text">kdb</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diff</span>;
                
                <span class="ActionScriptDefault_Text">_specularTransform</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">specularTransform</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_source</span><span class="ActionScriptBracket/Brace">][</span><span class="ActionScriptDefault_Text">_view</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">rfx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_specularTransform</span>.<span class="ActionScriptDefault_Text">szx</span>;
                <span class="ActionScriptDefault_Text">rfy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_specularTransform</span>.<span class="ActionScriptDefault_Text">szy</span>;
                <span class="ActionScriptDefault_Text">rfz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_specularTransform</span>.<span class="ActionScriptDefault_Text">szz</span>;
                
                <span class="ActionScriptDefault_Text">rf</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nx</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">rfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">ny</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">rfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nz</span>;
                
                <span class="ActionScriptDefault_Text">spec</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">directional</span>.<span class="ActionScriptDefault_Text">specular</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">pow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rf</span>, <span class="ActionScriptDefault_Text">shininess</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">specular_brightness</span>;
                
                <span class="ActionScriptDefault_Text">ksr</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span>;
                <span class="ActionScriptDefault_Text">ksg</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span>;
                <span class="ActionScriptDefault_Text">ksb</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_tri_source_lightarray_points</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">lightarray</span>.<span class="ActionScriptDefault_Text">points</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">point</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">PointLight</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">point</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_tri_source_lightarray_points</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span>.<span class="ActionScriptDefault_Text">red</span>;
                <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span>.<span class="ActionScriptDefault_Text">green</span>;
                <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span>.<span class="ActionScriptDefault_Text">blue</span>;
                
                <span class="ActionScriptDefault_Text">_viewPosition</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span>.<span class="ActionScriptDefault_Text">viewPositions</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">view</span><span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewPosition</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c0x</span>;
                <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewPosition</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c0y</span>;
                <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewPosition</span>.<span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c0z</span>;
                <span class="ActionScriptDefault_Text">df</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">df</span>;
                <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">df</span>;
                <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">df</span>;
                <span class="ActionScriptDefault_Text">fade</span> <span class="ActionScriptOperator">=</span> 1 <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">df</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">df</span>;
                
                <span class="ActionScriptDefault_Text">amb</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span>.<span class="ActionScriptDefault_Text">ambient</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">fade</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">ambient_brightness</span>;

                <span class="ActionScriptDefault_Text">kar</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">amb</span>;
                <span class="ActionScriptDefault_Text">kag</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">amb</span>;
                <span class="ActionScriptDefault_Text">kab</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">amb</span>;
                
                <span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pa</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pb</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pc</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">continue</span>;

                <span class="ActionScriptDefault_Text">diff</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span>.<span class="ActionScriptDefault_Text">diffuse</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">fade</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diffuse_brightness</span>;

                <span class="ActionScriptDefault_Text">kdr</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diff</span>;
                <span class="ActionScriptDefault_Text">kdg</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diff</span>;
                <span class="ActionScriptDefault_Text">kdb</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">diff</span>;
                
                <span class="ActionScriptDefault_Text">rfz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nf</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pc</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rfz</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">continue</span>;

                <span class="ActionScriptDefault_Text">rfx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nf</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pa</span>;
                <span class="ActionScriptDefault_Text">rfy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nf</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pb</span>;
                
                <span class="ActionScriptDefault_Text">spec</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span>.<span class="ActionScriptDefault_Text">specular</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">fade</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">pow</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rfz</span>, <span class="ActionScriptDefault_Text">shininess</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">specular_brightness</span>;

                <span class="ActionScriptDefault_Text">ksr</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span>;
                <span class="ActionScriptDefault_Text">ksg</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span>;
                <span class="ActionScriptDefault_Text">ksb</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">spec</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">renderTri</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tri</span>, <span class="ActionScriptDefault_Text">session</span>, <span class="ActionScriptDefault_Text">kar</span>, <span class="ActionScriptDefault_Text">kag</span>, <span class="ActionScriptDefault_Text">kab</span>, <span class="ActionScriptDefault_Text">kdr</span>, <span class="ActionScriptDefault_Text">kdg</span>, <span class="ActionScriptDefault_Text">kdb</span>, <span class="ActionScriptDefault_Text">ksr</span>, <span class="ActionScriptDefault_Text">ksg</span>, <span class="ActionScriptDefault_Text">ksb</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">draw_fall</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">draw_reflect</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">draw_normal</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">graphics</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">session</span>.<span class="ActionScriptDefault_Text">graphics</span>,
                <span class="ActionScriptDefault_Text">cz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c0z</span>,
                <span class="ActionScriptDefault_Text">cx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c0x</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">zoom</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cz</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptBracket/Brace">)</span>,
                <span class="ActionScriptDefault_Text">cy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c0y</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">zoom</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span>1 <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">cz</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">focus</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">draw_normal</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">ncz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0z</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pc</span><span class="ActionScriptBracket/Brace">)</span>,
                    <span class="ActionScriptDefault_Text">ncx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0x</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pa</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">zoom</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ncz</span><span class="ActionScriptBracket/Brace">)</span>,
                    <span class="ActionScriptDefault_Text">ncy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0y</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pb</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">zoom</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ncz</span><span class="ActionScriptBracket/Brace">)</span>;

                    <span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptBracket/Brace">(</span>1, 0<span class="ActionScriptDefault_Text">x000000</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">moveTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cx</span>, <span class="ActionScriptDefault_Text">cy</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">lineTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ncx</span>, <span class="ActionScriptDefault_Text">ncy</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">moveTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cx</span>, <span class="ActionScriptDefault_Text">cy</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">drawCircle</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cx</span>, <span class="ActionScriptDefault_Text">cy</span>, 2<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">draw_fall</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">draw_reflect</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_tri_source_lightarray_points_new</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tri</span>.<span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">lightarray</span>.<span class="ActionScriptDefault_Text">points</span>;
                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">point</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_tri_source_lightarray_points_new</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span>.<span class="ActionScriptDefault_Text">red</span>;
                        <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span>.<span class="ActionScriptDefault_Text">green</span>;
                        <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">point</span>.<span class="ActionScriptDefault_Text">blue</span>;
                        <span class="ActionScriptDefault_Text">sum</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">blue</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 0<span class="ActionScriptDefault_Text">xFF</span>;
                        <span class="ActionScriptDefault_Text">red</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">sum</span>;
                        <span class="ActionScriptDefault_Text">green</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">sum</span>;
                        <span class="ActionScriptDefault_Text">blue</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">sum</span>;
                
                        <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewPosition</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c0x</span>;
                        <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewPosition</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c0y</span>;
                        <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_viewPosition</span>.<span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">c0z</span>;
                        <span class="ActionScriptDefault_Text">df</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">sqrt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">df</span>;
                        <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">df</span>;
                        <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">/=</span> <span class="ActionScriptDefault_Text">df</span>;
                
                        <span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pa</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pb</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pc</span>;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nf</span> <span class="ActionScriptOperator">&lt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptReserved">continue</span>;
                
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">draw_fall</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">ffz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0z</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">draw_fall_k</span><span class="ActionScriptBracket/Brace">))</span>,
                            <span class="ActionScriptDefault_Text">ffx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0x</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">draw_fall_k</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">zoom</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ffz</span><span class="ActionScriptBracket/Brace">)</span>,
                            <span class="ActionScriptDefault_Text">ffy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0y</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">draw_fall_k</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">zoom</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ffz</span><span class="ActionScriptBracket/Brace">)</span>,

                            <span class="ActionScriptDefault_Text">fz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0z</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfz</span><span class="ActionScriptBracket/Brace">)</span>,
                            <span class="ActionScriptDefault_Text">fx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0x</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfx</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">zoom</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">fz</span><span class="ActionScriptBracket/Brace">)</span>,
                            <span class="ActionScriptDefault_Text">fy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0y</span> <span class="ActionScriptOperator">+</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">dfy</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">zoom</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">fz</span><span class="ActionScriptBracket/Brace">)</span>;

                            <span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptBracket/Brace">(</span>1, <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">red</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>0<span class="ActionScriptDefault_Text">x10000</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">green</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>0<span class="ActionScriptDefault_Text">x100</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">blue</span><span class="ActionScriptBracket/Brace">)</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">moveTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ffx</span>, <span class="ActionScriptDefault_Text">ffy</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">lineTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fx</span>, <span class="ActionScriptDefault_Text">fy</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">moveTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ffx</span>, <span class="ActionScriptDefault_Text">ffy</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>

                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">draw_reflect</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">rfx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfx</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nf</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pa</span>;
                            <span class="ActionScriptDefault_Text">rfy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfy</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nf</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pb</span>;
                            <span class="ActionScriptDefault_Text">rfz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">dfz</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">nf</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">pc</span>;
                    
                            <span class="ActionScriptDefault_Text">rz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0z</span> <span class="ActionScriptOperator">-</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">rfz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">draw_reflect_k</span><span class="ActionScriptBracket/Brace">)</span>,
                            <span class="ActionScriptDefault_Text">rx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0x</span> <span class="ActionScriptOperator">-</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">rfx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">draw_reflect_k</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">zoom</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">rz</span><span class="ActionScriptBracket/Brace">)</span>,
                            <span class="ActionScriptDefault_Text">ry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c0y</span> <span class="ActionScriptOperator">-</span> 30<span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">rfy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">draw_reflect_k</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">zoom</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">focus</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">rz</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                            <span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptBracket/Brace">(</span>1, <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">red</span><span class="ActionScriptOperator">*</span>0.5<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>0<span class="ActionScriptDefault_Text">x10000</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">green</span><span class="ActionScriptOperator">*</span>0.5<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span>0<span class="ActionScriptDefault_Text">x100</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">blue</span><span class="ActionScriptOperator">*</span>0.5<span class="ActionScriptBracket/Brace">)</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">moveTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cx</span>, <span class="ActionScriptDefault_Text">cy</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">lineTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rx</span>, <span class="ActionScriptDefault_Text">ry</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">moveTo</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">cx</span>, <span class="ActionScriptDefault_Text">cy</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addOnMaterialUpdate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">listener</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MaterialEvent</span>.<span class="ActionScriptDefault_Text">MATERIAL_UPDATED</span>, <span class="ActionScriptDefault_Text">listener</span>, <span class="ActionScriptReserved">false</span>, 0, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * @inheritDoc
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeOnMaterialUpdate</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">listener</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MaterialEvent</span>.<span class="ActionScriptDefault_Text">MATERIAL_UPDATED</span>, <span class="ActionScriptDefault_Text">listener</span>, <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
